<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NextVG OS</title>
<style>
* { box-sizing:border-box; user-select:none; }
html,body {
  margin:0; height:100%; width:100%;
  background:#050505;
  font-family:Segoe UI, system-ui;
  overflow:hidden;
}

#desktop {
  position:absolute;
  inset:0 0 48px 0;
  background:#070a10;
  background-size:cover;
  background-position:center;
}

.window {
  position:absolute;
  background:#0d1117;
  border:1px solid #1f2937;
  border-radius:10px;
  box-shadow:0 0 30px #000;
  overflow:hidden;
  resize:both;
  min-width:260px;
  min-height:180px;
}

.titlebar {
  height:38px;
  background:#0b0f15;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 10px;
  cursor:move;
  color:#cbd5e1;
  font-weight:500;
  border-bottom:1px solid #1f2937;
}

.controls button {
  width:28px;
  height:28px;
  margin-left:6px;
  border:none;
  border-radius:6px;
  background:#111827;
  color:#cbd5e1;
  cursor:pointer;
}
.controls button:hover {
  background:#1f2937;
}

.content {
  height:calc(100% - 38px);
  background:#020617;
}

iframe, textarea {
  width:100%; height:100%;
  border:none;
  background:#020617;
  color:white;
}

/* Taskbar */
#taskbar {
  position:absolute;
  bottom:0; left:0; right:0;
  height:48px;
  background:#05080f;
  border-top:1px solid #111827;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 12px;
}

#apps {
  display:flex;
  gap:14px;
  justify-content:center;
  flex:1;
}

.appicon {
  width:38px;
  height:38px;
  border-radius:10px;
  background:#0f172a;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#e2e8f0;
  font-size:13px;
  cursor:pointer;
  position:relative;
}
.appicon.open::after {
  content:"";
  position:absolute;
  bottom:2px;
  width:16px;
  height:3px;
  background:#3b82f6;
  border-radius:2px;
}

#clock {
  font-size:12px;
  color:#94a3b8;
  text-align:right;
  min-width:120px;
}

.noselect { user-select:none; }
</style>
</head>
<body>

<div id="desktop"></div>

<div id="taskbar">
  <div style="color:#334155;font-size:12px">NextVG OS</div>
  <div id="apps"></div>
  <div id="clock"></div>
</div>
<script>
(() => {
  let enabled = true;

  function handler(e) {
    if (!enabled) return;
    e.preventDefault();
    e.returnValue = "";
    return "";
  }

  window.addEventListener("beforeunload", handler);

  // Optional: expose a way to disable it if needed later
  window.__disableCloseProtection = () => {
    enabled = false;
  };
})();
</script>

<script>
document.addEventListener("contextmenu", e => e.preventDefault());

const desktop = document.getElementById("desktop");
const appsBar = document.getElementById("apps");
const clock = document.getElementById("clock");

let topZ = 100;
const windows = {};

const defaultTheme = {
  ui: "#0f172a",
  accent: "#00f0ff",
  font: "Orbitron",
  bg: ""
};

const state = JSON.parse(localStorage.getItem("nextvg-theme") || "null") || defaultTheme;

function applyTheme() {
  document.documentElement.style.setProperty("--ui", state.ui);
  document.documentElement.style.setProperty("--accent", state.accent);
  document.body.style.fontFamily = `'${state.font}', sans-serif`;
  if (state.bg) desktop.style.backgroundImage = `url(${state.bg})`;
}
applyTheme();

function saveTheme() {
  localStorage.setItem("nextvg-theme", JSON.stringify(state));
}

const style = document.createElement("style");
style.innerHTML = `
@import url('https://fonts.googleapis.com/css2?family=Orbitron&family=Roboto&family=Ubuntu&family=Poppins&family=Fira+Code&family=JetBrains+Mono&family=Pacifico&family=Permanent+Marker&family=Share+Tech+Mono&family=Audiowide&display=swap');

.window {
  position:absolute;
  background:var(--ui);
  border:2px solid #222;
  resize:both;
  overflow:hidden;
}

.window.focused {
  border:2px solid transparent;
  background:
    linear-gradient(var(--ui),var(--ui)) padding-box,
    linear-gradient(120deg,var(--accent),#a855f7,#00ff88,var(--accent)) border-box;
  animation:hue 6s linear infinite;
  box-shadow:0 0 15px var(--accent);
}

@keyframes hue { from{filter:hue-rotate(0)} to{filter:hue-rotate(360deg)} }

.titlebar {
  background:#00000088;
  padding:6px;
  cursor:move;
  display:flex;
  justify-content:space-between;
  color:white;
}

.controls button {
  background:black;
  color:white;
  border:none;
  margin-left:4px;
  cursor:pointer;
}

iframe, textarea { width:100%; height:100%; border:none; background:black; color:white }

.appicon img {
  width:28px;
  height:28px;
  object-fit:contain;
}

.appicon svg {
  width:28px;
  height:28px;
}
`;
document.head.appendChild(style);

function focusWindow(win){
  win.style.zIndex = ++topZ;
  document.querySelectorAll(".window").forEach(w => w.classList.remove("focused"));
  win.classList.add("focused");
}

function createWindow(id,title,content){
  if(windows[id]) return toggle(id);

  const win = document.createElement("div");
  win.className = "window";
  win.style.left = "120px";
  win.style.top = "80px";
  win.style.width = "600px";
  win.style.height = "400px";
  win.style.zIndex = ++topZ;

  win.onmousedown = () => focusWindow(win);

  const bar = document.createElement("div");
  bar.className = "titlebar";
  bar.innerHTML = `<span>${title}</span>`;

  const ctr = document.createElement("div");
  ctr.className = "controls";
  ctr.innerHTML = `<button>â€“</button><button>â–¢</button><button>âœ•</button>`;
  bar.appendChild(ctr);

  const body = document.createElement("div");
  body.style.height = "calc(100% - 30px)";

  if(content === "settings"){
    body.innerHTML = `
    <div style="padding:10px;color:white">
      <h2>NextVG OS Settings</h2>
      UI Color: <input type="color" value="${state.ui}" onchange="state.ui=this.value;applyTheme();saveTheme()"><br><br>
      Accent: <input type="color" value="${state.accent}" onchange="state.accent=this.value;applyTheme();saveTheme()"><br><br>
      Font:
      <select onchange="state.font=this.value;applyTheme();saveTheme()">
        <option>Orbitron</option><option>Roboto</option><option>Ubuntu</option>
        <option>Poppins</option><option>Fira Code</option><option>JetBrains Mono</option>
        <option>Pacifico</option><option>Permanent Marker</option>
        <option>Share Tech Mono</option><option>Audiowide</option>
      </select><br><br>
      Background: <input type="file" onchange="setBg(this.files[0])">
    </div>`;
  }
  else if(content === "minecraft"){
    body.innerHTML = `
    <div style="padding:10px;color:white">
      <button onclick="launchMC('1.12')">Launch 1.12</button>
      <div id="mc12"></div><br>
      <button onclick="launchMC('1.8')">Launch 1.8</button>
      <div id="mc18"></div>
    </div>`;
  }
  else {
    const iframe = document.createElement("iframe");
    iframe.src = atob(content);
    body.appendChild(iframe);
  }

  win.append(bar, body);
  desktop.appendChild(win);
  windows[id] = win;
  focusWindow(win);

  let ox, oy, drag=false;
  bar.onmousedown = e => {
    drag=true;
    ox=e.clientX-win.offsetLeft;
    oy=e.clientY-win.offsetTop;
  };
  window.onmouseup=()=>drag=false;
  window.onmousemove=e=>{
    if(drag){
      win.style.left = e.clientX-ox+"px";
      win.style.top = e.clientY-oy+"px";
    }
  };

  ctr.children[0].onclick=()=>win.style.display="none";
  ctr.children[2].onclick=()=>{win.remove(); delete windows[id];};
}

function toggle(id){
  const w = windows[id];
  w.style.display = w.style.display==="none"?"block":"none";
  focusWindow(w);
}

function setBg(file){
  const r=new FileReader();
  r.onload=e=>{
    state.bg=e.target.result;
    applyTheme();
    saveTheme();
  };
  r.readAsDataURL(file);
}

async function launchMC(ver){
  const res = await fetch(ver+".html");
  const html = await res.text();
  const blob = new Blob([html],{type:"text/html"});
  const url = URL.createObjectURL(blob);
  document.getElementById(ver==="1.12"?"mc12":"mc18").innerHTML =
    `<button onclick="window.open('${url}','_blank','k:pop')">Open Again</button>`;
  window.open(url,'_blank','k:pop');
}

/* ---------- APPS ---------- */

const apps = [
  ["NextBrowser","NXB","aHR0cHM6Ly85Mjg1MC52ZXJjZWwuYXBw", `<img src="https://92850.vercel.app/favicon.ico">`],
  ["KB Browser","KBB","aHR0cHM6Ly9rYnNpZ21hYm95NjctaGFja3MuYm9sdC5ob3N0", `<img src="https://kbsigmaboy67-hacks.bolt.host/favicon.ico">`],
  ["Google","GGL","aHR0cHM6Ly9nb29nbGUuY29tP2lndT0x", `<img src="https://www.google.com/favicon.ico">`],
  ["RammerHead","RHM","aHR0cHM6Ly9lZmx5LjEwOC0xODEtMzItNzcuc3NsaXAuaW8=", `<img src="https://efly.108-181-32-77.sslip.io/favicon.png">`],
  ["MacVG MiniGames","MAC","aHR0cHM6Ly9tZmQwMG1mYXJtLmdpdGh1Yi5pby9tYWN2Zw==", `<svg viewBox="0 0 100 100"><text x="10" y="65" font-size="60">ðŸŽ®</text></svg>`],
  ["Settings","SET","settings", `<img src="https://cdn-icons-png.flaticon.com/512/3524/3524659.png">`],
  ["Minecraft Apps","MCA","minecraft", `<img src="https://upload.wikimedia.org/wikipedia/en/5/51/Minecraft_cover.png">`]
];

apps.forEach(([name,id,url,icon])=>{
  const el = document.createElement("div");
  el.className = "appicon";
  el.innerHTML = icon;
  el.title = name;
  el.onclick = () => createWindow(id,name,url);
  appsBar.appendChild(el);
});

setInterval(()=>{
  const d = new Date();
  clock.textContent = d.toLocaleTimeString() + " " + d.toLocaleDateString();
},1000);
</script>



</body>
</html>
